traefik.enable: 'true'

## HTTP Routers
traefik.http.routers.{{pgrole}}-rtr.entrypoints: 'http,https'
traefik.http.routers.{{pgrole}}-rtr.rule: 'Host(`{{ sub[pgrole][pgrole] if sub_enabled else pgrole }}.{{ user.domain }}`)' 
traefik.http.routers.{{pgrole}}-rtr.tls: 'true'

## Middlewares
{% if auth_enabled and sub[pgrole].auth | default('') == 'basique' %}
traefik.http.routers.{{pgrole}}-rtr.middlewares: 'chain-basic-auth@file'
{% elif auth_enabled and sub[pgrole].auth | default('') == 'oauth' %}
traefik.http.routers.{{pgrole}}-rtr.middlewares: 'chain-oauth@file'
{% elif auth_enabled and sub[pgrole].auth | default('') == 'authelia' %}
traefik.http.routers.{{pgrole}}-rtr.middlewares: 'chain-authelia@file'
{% elif auth_enabled and sub[pgrole].auth | default('') == 'oauth2-proxy' %}
traefik.http.routers.{{pgrole}}-rtr.middlewares: 'chain-oauth2-proxy@file'
{% elif oauth2proxy_enabled and sub[pgrole].auth | default('') != 'aucune' %}
traefik.http.routers.{{pgrole}}-rtr.middlewares: 'chain-oauth2-proxy@file'
{% else %}
traefik.http.routers.{{pgrole}}-rtr.middlewares: 'chain-no-auth@file'
{% endif %}

traefik.http.routers.{{pgrole}}-rtr.service: '{{pgrole}}-svc'
traefik.http.routers.{{pgrole}}-rtr.tls.certresolver: 'letsencrypt'

## HTTP Services
traefik.http.services.{{pgrole}}-svc.loadbalancer.server.port: "{{ intport }}"

## Extra labels (application-specific)
{# AJOUT DES SPECIFIQUES #}
{% for ligne in extra_labels|list %}
{{ ligne }}: "{{ extra_labels[ligne] }}"
{% endfor %}
