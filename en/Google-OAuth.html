<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ssdv2 | SSDv2</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="ssdv2" />
<meta property="og:locale" content="en" />
<meta name="description" content="Simple Seedbox docker" />
<meta property="og:description" content="Simple Seedbox docker" />
<meta property="og:site_name" content="SSDv2" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ssdv2" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Simple Seedbox docker","headline":"ssdv2","url":"/ssdv2/en/Google-OAuth.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/ssdv2/en/assets/css/style.css?v=">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/ssdv2/en/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/ssdv2/en/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#353535">
<meta name="msapplication-navbutton-color" content="#353535">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/ssdv2/en/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
<!--      <div id="header">-->
<!--        <nav>-->
<!--          <ul>-->
<!--            <li class="fork"><a href="">View On GitHub</a></li>-->
<!--            -->
<!--          </ul>-->
<!--        </nav>-->
<!--      </div>&lt;!&ndash; end header &ndash;&gt;-->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>SSDv2</h1>
          <p>Simple Seedbox docker</p>
          <hr>
            <span class="credits left">
                 
                    
                        <a href="/ssdv2//Google-OAuth.html">Français</a>
                    

                
                    

                
            </span>
<!--          <span class="credits left">Project maintained by <a href=""></a></span>-->
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/mattgraham">mattgraham</a></span>
        </div>

        <p>Google OAuth2 vous permet d’utiliser votre compte Google pour vous connecter à vos services.</p>

<p>L’utilisation de Google OAuth avec Traefik permet d’inscrire des comptes dans la liste blanche, de mettre en œuvre la norme 2FA de Google et de fournir une authentification unique (SSO) à vos services.</p>

<p>Cela offre, non seulement l’avantage de ne pas avoir de demandes de connexions fréquentes, mais améliore également la sécurité.</p>

<h2 id="configuration-google-oauth2-service">Configuration Google OAuth2 Service</h2>

<blockquote>
  <h4 id="note">Note</h4>
  <p>Pour ceux qui utilisent Cloudflare, la création du CNAME est automatisée par le script, pour les autres pensez à le créer auprès de votre Registrar.<br />
<img src="https://user-images.githubusercontent.com/64525827/105626357-56f06100-5e2f-11eb-815d-684ea953c4c8.png" alt="01-clouldflare-dns-records-for-traefik-google-oauth-740x265" /></p>
</blockquote>

<h3 id="nous-allons-à-nouveau-créer-un-projet-cette-fois-pour-traefik-google-oauth">Nous allons à nouveau créer un projet cette fois pour traefik Google oAuth</h3>

<ul>
  <li>Rendez vous à l’adresse suivante et connectez vous avec votre compte Gsuite :<br />
<a href="https://href.li/?https://console.cloud.google.com/cloud-resource-manager">Google Apps Script API</a></li>
</ul>

<blockquote>
  <p>ATTENTION : Vous devez être sur et certains de vous connecter au bon compte Google.
Si vous en avez plusieurs, connectez-vous alors en fenêtre de navigation privée !</p>
</blockquote>

<ul>
  <li>
    <h3 id="cliquez-sur-créer-un-projet">Cliquez sur Créer un projet</h3>
    <p><img src="https://user-images.githubusercontent.com/64525827/119948392-14839000-bf99-11eb-96a0-c7509bde74e9.png" alt="creer_un_projet" /><br />
<br /><br /></p>
  </li>
  <li>
    <h3 id="entrer-le-nom-du-projet-oauth-puis-cliquer-sur-créer">Entrer le nom du projet <code class="highlighter-rouge">oauth</code> puis cliquer sur Créer</h3>
    <p><img src="https://user-images.githubusercontent.com/64525827/119948566-3f6de400-bf99-11eb-8ddf-ce61d54a76b4.png" alt="creation_projet" /><br />
<br /><br /></p>
  </li>
  <li>
    <h3 id="dans-la-notification-en-haut-à-droite-cliquer-sur-sélectionner-un-projet">Dans la notification en haut à droite, cliquer sur “sélectionner un projet”</h3>
    <p><img src="https://user-images.githubusercontent.com/64525827/119949044-c28f3a00-bf99-11eb-8c9f-3342f6c0649e.png" alt="notification" /></p>
  </li>
</ul>

<h3 id="après-linstallation-cliquer-sur-identifiants">Après l’installation cliquer sur “identifiants”</h3>
<p><img src="https://user-images.githubusercontent.com/64525827/119950352-0a629100-bf9b-11eb-923c-fd49240cc6e0.png" alt="identifiant" />
<br /><br />
Dans la nouvelel fenetre, cliquer sur “Créer des identifiants” puis sur “ID client OAuth”
<img src="https://user-images.githubusercontent.com/64525827/119950515-33832180-bf9b-11eb-9e12-14995ab54f3c.png" alt="creation_identifiant" /><br />
<br /><br />
Il y a une étape intermédiaire, cliquer sur “Configurer l’écran d’autorisation”<br />
<img src="https://user-images.githubusercontent.com/64525827/119950915-af7d6980-bf9b-11eb-9d4a-f51a90294427.png" alt="configurer oauth" /><br />
<br /><br />
puis sélectionner “externe” et Créer<br />
<img src="https://user-images.githubusercontent.com/64525827/119951092-dc318100-bf9b-11eb-8fb2-79b59052fecf.png" alt="externe" />
<br /><br />
Dans la nouvelle fenêtre, remplissez les champs :</p>
<ul>
  <li>Nom de l’application =&gt; <code class="highlighter-rouge">identique au nom du projet</code></li>
  <li>Adresse e-mail d’assistance utilisateur =&gt; <code class="highlighter-rouge">sélectionner celle du compte google</code></li>
  <li>Coordonnées du développeur (Adresse email) =&gt; <code class="highlighter-rouge">Entrer votre email</code></li>
</ul>

<h3 id="sur-chaque-étapes-cliqurer-en-bas-sur-enregistrer">Sur chaque étapes, cliqurer en bas sur enregistrer</h3>
<p><img src="https://user-images.githubusercontent.com/64525827/119951704-8a3d2b00-bf9c-11eb-9632-8c3698a45e5d.png" alt="etapes" />
<br /><br />
Une fois terminé, cliquer à nouveau sur “Identifiants” sur la gauche de l’écran<br />
Puis :</p>
<ul>
  <li>Créer des identifiants</li>
  <li>ID client OAuth</li>
  <li>Type d’application  =&gt; <code class="highlighter-rouge">Application web</code></li>
  <li>Nom =&gt; <code class="highlighter-rouge">identique au nom du projet</code></li>
  <li>URI =&gt; <code class="highlighter-rouge">https://oauth.example.com/_oauth</code><br />
<img src="https://user-images.githubusercontent.com/64525827/119953309-2451a300-bf9e-11eb-9a85-fb8414e3c667.png" alt="oauth" /> <br />
<br /><br /></li>
</ul>

<h3 id="vous-aurez-besoin-par-la-suite-de-ces-identifiants-pour-créer-votre-rclone">Vous aurez besoin par la suite de ces identifiants pour créer votre Rclone.</h3>
<p><img src="https://user-images.githubusercontent.com/64525827/119952283-236c4180-bf9d-11eb-9937-86ca1d319f1c.png" alt="identifians_ok" />
<br /><br /></p>

<ul>
  <li>
    <h3 id="copier-sur-un-bloc-note-le-client-id-et-le-client-secret">Copier sur un bloc note le CLIENT ID et le CLIENT SECRET</h3>
    <p><img src="https://user-images.githubusercontent.com/64525827/105181463-1ee5d700-5b2c-11eb-85b1-55a14668ea34.jpeg" alt="google-apps-script-api-client-id-et-secret" /></p>
  </li>
</ul>

<h3 id="vous-aurez-besoin-par-la-suite-de-ces-identifiants">Vous aurez besoin par la suite de ces identifiants.</h3>

<p>Si vous avez fermer la fenêtre avec vos identifiants, vous pouvez les retrouver dans la rubrique identifiant de projet drive. <a href="https://href.li/?https://console.developers.google.com">Dashboard API</a>.</p>

<p><img src="https://user-images.githubusercontent.com/64525827/105181488-2907d580-5b2c-11eb-9b8b-cc39e3e2ed04.jpg" alt="projets-google-api-identifiants" /></p>

<hr />
<blockquote>
  <h2 id="bonus">BONUS</h2>
  <hr />
  <h4 id="google-oauth-et-nzb360-lunasea-etc">Google OAuth et NZB360, LunaSea etc…</h4>
  <p>L’idée est d’utiliser des règles spécifiques par exemple, si l’en-tête de requête contient l’API sabnzbd, radarr, sonarr etc .. on contourne l’authentification.</p>
</blockquote>

<p>Du coup c’est un amalgame de middleware avec et sans authentification qui d’une manière plus générale déclenche l’authentification google Oauth via le web tout en permettant l’accès sur NZB360 et en préservant la sécurité d’accés.</p>

<p>La procédure est très simple, il suffit juste de changer les labels de traefik dans les applis sabnzbd, lidarr, sonarr, radarr, rutorrent.</p>

<h4 id="sabnzbd">Sabnzbd</h4>

<p>Avant</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>traefik.enable: 'true'
## HTTP Routers
traefik.http.routers.sabnzbd-rtr.entrypoints: 'https'
traefik.http.routers.sabnzbd-rtr.rule: 'Host(`sabnzbd.`)'
traefik.http.routers.sabnzbd-rtr.tls: 'true'
## Middlewares
traefik.http.routers.sabnzbd-rtr.middlewares: "chain-oauth@file"
## HTTP Services
traefik.http.routers.sabnzbd-rtr.service: 'sabnzbd-svc'
traefik.http.services.sabnzbd-svc.loadbalancer.server.port: '8080'
</code></pre></div></div>
<p>Après</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>traefik.enable: 'true'
traefik.http.routers.sabnzbd-rtr-bypass.entrypoints: 'https'
traefik.http.routers.sabnzbd-rtr-bypass.rule: 'Query(`apikey`, `api_de_sabnzbd`)'
traefik.http.routers.sabnzbd-rtr-bypass.priority: '100'
traefik.http.routers.sabnzbd-rtr-bypass.tls: 'true'
## HTTP Routers Auth
traefik.http.routers.sabnzbd-rtr.entrypoints: 'https'
traefik.http.routers.sabnzbd-rtr.rule: 'Host(`sabnzbd.`)
traefik.http.routers.sabnzbd-rtr.priority: '99'
traefik.http.routers.sabnzbd-rtr.tls: 'true'
## Middlewares
traefik.http.routers.sabnzbd-rtr-bypass.middlewares: 'chain-no-auth@file'
traefik.http.routers.sabnzbd-rtr.middlewares: 'chain-oauth@file'
## HTTP Services
traefik.http.routers.sabnzbd-rtr.service: 'sabnzbd-svc'
traefik.http.routers.sabnzbd-rtr-bypass.service: 'sabnzbd-svc'
traefik.http.services.sabnzbd-svc.loadbalancer.server.port: '8080'
</code></pre></div></div>
<p>Ne pas oublier de mettre la clé API à la place de api_de_sabnzbd. Ensuite réinitialiser avec le script</p>

<h4 id="sonarr-radarr-lidarr">sonarr, radarr, lidarr</h4>
<p>Même procédure que pour sabnzbd sauf un label que l’on va modifier.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>traefik.http.routers.sonarr-rtr-bypass.rule: 'Headers(`X-Api-Key`, `api_sonarr`)'
</code></pre></div></div>
<h4 id="rutorrent">rutorrent</h4>
<p>Remplacer vos middlewares par ce qui suit :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>traefik.enable: 'true'
traefik.http.routers.rutorrent-rtr-bypass.entrypoints: 'https'
traefik.http.routers.rutorrent-rtr-bypass.rule: 'Path(`/RPC2`)'
traefik.http.routers.rutorrent-rtr-bypass.priority: '100'
traefik.http.routers.rutorrent-rtr-bypass.tls: 'true'
## HTTP Routers Auth
traefik.http.routers.rutorrent-rtr.entrypoints: 'https'
traefik.http.routers.rutorrent-rtr.rule: 'Host(`rutorrent.`)'
traefik.http.routers.rutorrent-rtr.priority: '99'
traefik.http.routers.rutorrent-rtr.tls: 'true'
## Middlewares
traefik.http.routers.rutorrent-rtr-bypass.middlewares: 'chain-basic-auth@file'
traefik.http.routers.rutorrent-rtr.middlewares: 'chain-oauth@file'
## HTTP Services
traefik.http.routers.rutorrent-rtr.service: 'rutorrent-svc'
traefik.http.routers.rutorrent-rtr-bypass.service: 'rutorrent-svc'
traefik.http.services.rutorrent-svc.loadbalancer.server.port: '8080'
</code></pre></div></div>
<p>Par mesure de sécurité on rajoute une couche d’authentification basique pour l’acces à nzb360<br />
Du coup pour faire fonctionner sonarr, radarr, lidarr à la fois sur NZb360 et LunaSea tu modifies le label de cette façon</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>traefik.http.routers.sonarr-rtr-bypass.rule: 'Headers(`X-Api-Key`, `b12d1732186a4376b80bdb3875a0f39d`) || Query(`apikey`, `b12d1732186a4376b80bdb3875a0f39d`)'
</code></pre></div></div>


      </section>

    </div>
  </body>
</html>
