<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ssdv2 | SSDv2</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="ssdv2" />
<meta property="og:locale" content="en" />
<meta name="description" content="Simple Seedbox docker" />
<meta property="og:description" content="Simple Seedbox docker" />
<meta property="og:site_name" content="SSDv2" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ssdv2" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Simple Seedbox docker","headline":"ssdv2","url":"/ssdv2/en/S%C3%A9curisation-Seedbox.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/ssdv2/en/assets/css/style.css?v=">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/ssdv2/en/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/ssdv2/en/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#353535">
<meta name="msapplication-navbutton-color" content="#353535">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/ssdv2/en/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
<!--      <div id="header">-->
<!--        <nav>-->
<!--          <ul>-->
<!--            <li class="fork"><a href="">View On GitHub</a></li>-->
<!--            -->
<!--          </ul>-->
<!--        </nav>-->
<!--      </div>&lt;!&ndash; end header &ndash;&gt;-->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>SSDv2</h1>
          <p>Simple Seedbox docker</p>
          <hr>
            <span class="credits left">
                 
                    
                        <a href="/ssdv2//S%C3%A9curisation-Seedbox.html">Français</a>
                    

                
                    

                
            </span>
<!--          <span class="credits left">Project maintained by <a href=""></a></span>-->
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/mattgraham">mattgraham</a></span>
        </div>

        <p>Parce que le port ssh est le plus exposé aux attaques, il est fortement conseillé à la fois d’atttribuer un autre port que le 22 par défault (ce que nous verrons plus bas) mais également de mettre en place une authentification par clés.</p>

<h4 id="création-des-clés-dauthentification">Création des clés d’authentification</h4>
<h4 id="1-windows">1. Windows</h4>
<h5 id="générer-une-paire-de-clés-sous-windows">Générer une paire de clés sous Windows</h5>

<p>La plupart des connexions SSH sous Windows sont initialisées avec le client Putty qui est simple et efficace. L’outil PuttyGen permet de générer facilement un jeu de clés qui nous permettra de nous authentifier sur un serveur en les utilisant. On doit donc commencer par télécharger PuttyGen sur la page de téléchargement de Putty : http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html<br />
<br />
Une fois téléchargé, nous l’exécuterons en cliquant sur l’exécutable:<br />
<br />
<img src="https://www.it-connect.fr/wp-content-itc/uploads/2015/07/linux-ssh-cle-authentification-01.jpg" alt="" /><br />
<br />
Il nous faut ensuite sélectionner le type de clé que nous voulons générer, “SSH-1 (RSA)” et “SSH-2-RSA” correspondent à la version du protocole pour des clés RSA et “SSH-2- DSA” pour la création d’une clé DSA.<br />
<br />
On peut également choisir le nombre de bits pour notre clé (au minimum 2048 !). On cliquera ensuite sur “Generate“. Il faudra alors bouger la souris pour générer de l’entropie et cela jusqu’à ce que la barre de chargement soit pleine:<br />
<br />
<img src="https://www.it-connect.fr/wp-content-itc/uploads/2015/07/linux-ssh-cle-authentification-02.jpg" alt="" /><br />
<br />
Une fois terminé, nous aurons cet affichage:<br />
<br />
<img src="https://www.it-connect.fr/wp-content-itc/uploads/2015/07/linux-ssh-cle-authentification-03.jpg" alt="" /><br />
<br />
On voit donc bien notre clé générée. On peut également, avant de l’enregistrer, ajouter un commentaire et une passphrase. La passphrase permet d’ajouter une couche de sécurité. C’est le même principe qu’un mot de passe. Si votre clé privée se retrouve dans les mains d’un attaquant, il lui faudra la passphrase pour l’utiliser. Il est possible de ne pas mettre de passphrase. Nous aurons alors un avertissement comme quoi il est préférable d’entrer une passphrase mais nous pourrons continuer. Il faut donc finir par cliquer sur “Save private key” et “Save public key”. Nous pourrons ensuite fermer PuttyGen.</p>

<h4 id="2-mettre-la-clé-sur-le-serveur">2. Mettre la clé sur le serveur</h4>
<p>Il nous suffira alors simplement de copier le contenu de notre clé publique (par défaut “.ssh/id_rsa.pub”) dans le fichier “.ssh/authorized_keys” de l’utilisateur du serveur visé.<br />
<br />
Nous supposons ici que nous voulons une connexion sur le compte “root” (c’est bien sûr déconseillé dans un cadre réel). Nous allons donc aller dans le dossier “root” de cet utilisateur et créer le dossier “.ssh” s’il n’existe pas déjà:</p>

<blockquote>
  <p>mkdir .ssh</p>
</blockquote>

<p>Le dossier “.ssh” est là où vont se situer les informations relatives aux comptes et aux connexions SSH de l’utilisateur. Nous y créerons le fichier “authorized_keys” s’il n’existe pas. Ce fichier contient toutes les clés publiques que permettent d’établir des connexions avec le serveur et l’utilisateur dans lequel il se trouve (selon le dossier “home” dans lequel il se trouve). Nous allons ensuite dans ce fichier mettre notre clé publique (éviter de mettre les “=== BEGIN===” et “===END===” générés automatiquement par PuttyGen).<br />
<br />
Il nous faudra ensuite donner les droits les plus restreints à ce fichier par sécurité et pour les exigences d’OpenSSH:</p>

<blockquote>
  <p>chmod 700 ~/.ssh -Rf</p>
</blockquote>

<p>Notre clé est maintenant présente sur le serveur, il nous reste plus qu’à nous connecter pour tester!</p>
<h5 id="authentification-ssh-par-clé-sous-windows">Authentification SSH par clé sous Windows</h5>
<p>Putty a maintenant besoin de savoir où se situe notre clé privée pour établir une communication valable avec le serveur. Après l’avoir lancé et avoir renseigné l’IP de notre serveur, nous nous rendrons dans la partie “Connexion” &gt; “SSH” &gt; “Auth” puis nous cliquerons sur “Browse” pour aller chercher notre clé privée à côté du champ “Private key file for authentication”:<br />
<br />
<img src="http://www.it-connect.fr/wp-content-itc/uploads/2015/07/linux-ssh-cle-authentification-04.jpg" alt="" /></p>
<h5 id="2-linux">2. Linux</h5>
<p>Pour générer des clés sur linux je vous invite à consulter ce lien à partir duquel je me suis plus qu’inspirer pour ce tuto ;)<br />
https://www.it-connect.fr/chapitres/authentification-ssh-par-cles/</p>
<h4 id="changement-du-port-ssh-installation-fail2ban-et-iptables">Changement du port SSH, installation fail2ban et iptables</h4>
<p>J’ai repris le travail de geerlingguy qui propose 2 roles ansibles déjà pré-configurés qui vont dans un 1er temps proposer le changement du port SSH, configurer fail2ban en conséquence et installer un iptables avec seulement le port SSH choisis d’ouvert.<br />
<br />
Tous les autres ports nécessaires au bon fonctionnement des applis sont gérés par docker qui interfère directement avec iptables.<br />
<br />
Pour les plus aguerris il est tout à fait possible de modifier les règles dans le fichier de config qui ressemble à çà:<br />
```firewall_state: started
firewall_enabled_at_boot: true</p>

<p>firewall_allowed_tcp_ports:</p>
<ul>
  <li>””
firewall_allowed_udp_ports: []
firewall_forwarded_tcp_ports: []
firewall_forwarded_udp_ports: []
firewall_additional_rules: []
firewall_enable_ipv6: false
firewall_ip6_additional_rules: []
firewall_log_dropped_packets: true</li>
</ul>

<h1 id="set-to-true-to-ensure-other-firewall-management-software-is-disabled">Set to true to ensure other firewall management software is disabled.</h1>
<p>firewall_disable_firewalld: false
firewall_disable_ufw: false</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Plus d'infos:  
https://github.com/geerlingguy/ansible-role-firewall  
&lt;br&gt;
Même chose pour ssh, possibilité de personnaliser le fichier sshd_config
```security_ssh_port: ""
security_ssh_password_authentication: "yes"
security_ssh_permit_root_login: "yes"
security_ssh_usedns: "no"
security_ssh_permit_empty_password: "no"
security_ssh_challenge_response_auth: "no"
security_ssh_gss_api_authentication: "no"
security_ssh_x11_forwarding: "no"

security_sudoers_passwordless: []
security_sudoers_passworded: []

security_autoupdate_enabled: true
security_autoupdate_blacklist: []

# Autoupdate mail settings used on Debian/Ubuntu only.
security_autoupdate_reboot: "false"
security_autoupdate_reboot_time: "03:00"
security_autoupdate_mail_to: ""
security_autoupdate_mail_on_error: true

security_fail2ban_enabled: false
</code></pre></div></div>
<p>Plus d’infos:<br />
https://github.com/geerlingguy/ansible-role-security<br />
<br />
Par défault j’ai laissé l’options suivante à “yes”</p>

<p><code class="highlighter-rouge">security_ssh_password_authentication: "yes"
security_ssh_permit_root_login: "yes"
</code>
Mais on peut très bien imaginer une création de clés uniquement pour votre user, et désactiver l’authentification par mots de passe et root. Penser toujours à laisser une fenêtre ssh ouverte pendant vos tests pour ne pas risquer d’être bloqué.</p>


      </section>

    </div>
  </body>
</html>
